<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÆ¢ÈòÖ‰∏≠ÂøÉ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Courier New", monospace;
            background: #000;
            color: #00ff00;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: -1;
        }

        .matrix-code-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .matrix-column {
            position: absolute;
            top: -100%;
            color: #00ff00;
            font-size: 14px;
            line-height: 1.2;
            text-shadow: 0 0 5px #00ff00;
            animation: matrix-drop 15s linear infinite;
        }

        @keyframes matrix-drop {
            0% {
                top: -100%;
                opacity: 1;
            }

            90% {
                opacity: 0.3;
            }

            100% {
                top: 100vh;
                opacity: 0;
            }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .title {
            font-size: 3rem;
            font-weight: bold;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00, 0 0 20px #00ff00;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #00aa00;
            font-size: 1.1rem;
        }

        .card {
            background: rgba(0, 20, 0, 0.9);
            border: 2px solid #00ff00;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.5), inset 0 0 20px rgba(0, 255, 0, 0.1);
        }

        .card-title {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: #00ff00;
            text-shadow: 0 0 5px #00ff00;
        }

        .client-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 12px;
            margin: 15px 0;
        }

        .client-btn {
            background: rgba(0, 20, 0, 0.8);
            border: 2px solid #00ff00;
            padding: 12px;
            color: #00ff00;
            font-family: "Courier New", monospace;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-shadow: 0 0 5px #00ff00;
        }

        .client-btn:hover {
            background: rgba(0, 255, 0, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 20px #00ff00;
        }

        .status-box {
            padding: 15px;
            background: rgba(0, 20, 0, 0.8);
            border: 1px solid #00ff00;
            margin: 10px 0;
        }

        .status-row {
            margin: 8px 0;
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #00ff00;
            font-weight: bold;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff00;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .form-input::placeholder {
            color: #00aa00;
            opacity: 0.7;
        }

        .form-hint {
            color: #00aa00;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .btn {
            background: rgba(0, 255, 0, 0.15);
            border: 2px solid #00ff00;
            padding: 12px 24px;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: rgba(0, 255, 0, 0.4);
            box-shadow: 0 0 20px #00ff00;
        }

        .btn-danger {
            border-color: #ff4444;
            color: #ff4444;
        }

        .btn-danger:hover {
            background: rgba(255, 0, 0, 0.3);
            box-shadow: 0 0 20px #ff4444;
        }

        .checkbox-group {
            padding: 15px;
            background: rgba(0, 20, 0, 0.6);
            border: 1px solid #00ff00;
        }

        .checkbox-item {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .checkbox-item input {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .sub-url {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff00;
            padding: 15px;
            word-break: break-all;
            display: none;
            margin-top: 15px;
        }

        .lang-selector {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .lang-selector select {
            background: rgba(0, 20, 0, 0.9);
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 8px 12px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
        }

        .version-text {
            position: fixed;
            top: 20px;
            right: 20px;
            color: #00ff00;
            opacity: 0.6;
            font-size: 0.8rem;
        }

        .status-msg {
            display: none;
            padding: 12px;
            margin: 15px 0;
            border: 1px solid #00ff00;
            background: rgba(0, 20, 0, 0.8);
        }

        .links-section {
            text-align: center;
            margin: 20px 0;
        }

        .links-section a {
            color: #00ff00;
            text-decoration: none;
            margin: 0 20px;
            font-size: 1.1rem;
        }

        .links-section a:hover {
            text-shadow: 0 0 10px #00ff00;
        }

        [dir="rtl"] .form-label {
            text-align: right;
        }

        [dir="rtl"] .btn {
            margin-left: 10px;
            margin-right: 0;
        }
    </style>
</head>

<body>
    <div class="matrix-bg"></div>
    <div class="matrix-code-rain" id="matrixCodeRain"></div>
    <div class="version-text" id="versionText"></div>
    <div class="lang-selector">
        <select id="languageSelector" onchange="changeLanguage(this.value)">
            <option value="zh">üá®üá≥ ‰∏≠Êñá</option>
            <option value="fa">üáÆüá∑ ŸÅÿßÿ±ÿ≥€å</option>
        </select>
    </div>

    <div class="container">
        <div class="header">
            <h1 class="title" id="pageTitle"></h1>
            <p class="subtitle" id="pageSubtitle"></p>
        </div>

        <!-- ÂÆ¢Êà∑Á´ØÈÄâÊã© -->
        <div class="card">
            <h2 class="card-title" id="clientTitle"></h2>
            <div class="client-grid" id="clientGrid"></div>
            <div class="sub-url" id="subUrl"></div>
        </div>

        <!-- Á≥ªÁªüÁä∂ÊÄÅ -->
        <div class="card">
            <h2 class="card-title" id="statusTitle"></h2>
            <div class="status-box" id="systemStatus">
                <div class="status-row" id="regionStatus"></div>
                <div class="status-row" id="geoInfo"></div>
                <div class="status-row" id="proxyIPStatus"></div>
                <div class="status-row" id="currentIP"></div>
                <div class="status-row" id="echStatus"></div>
                <div class="status-row" id="regionMatch"></div>
            </div>
        </div>

        <!-- ÈÖçÁΩÆÁÆ°ÁêÜ -->
        <div class="card" id="configCard" style="display: none;">
            <h2 class="card-title" id="configTitle"></h2>
            <div id="kvStatus" class="status-box"></div>

            <div id="configContent" style="display: none;">
                <!-- Âú∞Âå∫ÈÖçÁΩÆ -->
                <form id="regionForm">
                    <div class="form-group">
                        <label class="form-label" id="regionLabel"></label>
                        <select id="wkRegion" class="form-select"></select>
                        <small class="form-hint" id="wkRegionHint" style="display:none; color:#ffaa00;"></small>
                    </div>
                    <button type="submit" class="btn" id="saveRegionBtn"></button>
                </form>

                <!-- ÂçèËÆÆÈÄâÊã© -->
                <div class="form-group">
                    <label class="form-label" id="protocolLabel"></label>
                    <div class="checkbox-group">
                        <label class="checkbox-item"><input type="checkbox" id="ev" checked><span>VLESS</span></label>
                        <label class="checkbox-item"><input type="checkbox" id="et"><span>Trojan</span></label>
                        <label class="checkbox-item"><input type="checkbox" id="ex"><span>xhttp</span></label>
                        <hr style="border-color: rgba(0,255,0,0.3); margin: 15px 0;">
                        <label class="checkbox-item"><input type="checkbox" id="ech"><span>ECH (Encrypted Client
                                Hello)</span></label>
                        <div class="form-group" style="margin-top: 15px;">
                            <label class="form-label" id="trojanPwdLabel"></label>
                            <input type="text" id="tp" class="form-input" placeholder="">
                        </div>
                        <button type="button" class="btn" id="saveProtocolBtn"></button>
                    </div>
                </div>

                <!-- Âü∫Êú¨ÈÖçÁΩÆ -->
                <form id="basicConfigForm">
                    <div class="form-group">
                        <label class="form-label" id="customPathLabel"></label>
                        <input type="text" id="customPath" class="form-input" placeholder="/mypath">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="customIPLabel"></label>
                        <input type="text" id="customIP" class="form-input" placeholder="1.2.3.4:443">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="yxLabel"></label>
                        <input type="text" id="yx" class="form-input" placeholder="1.2.3.4:443#ËäÇÁÇπÂêç,5.6.7.8:80">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="yxURLLabel"></label>
                        <input type="text" id="yxURL" class="form-input" placeholder="">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="socksLabel"></label>
                        <input type="text" id="socksConfig" class="form-input" placeholder="user:pass@host:port">
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="homepageLabel"></label>
                        <input type="text" id="customHomepage" class="form-input" placeholder="https://example.com">
                        <small class="form-hint" id="homepageHint"></small>
                    </div>
                    <button type="submit" class="btn" id="saveConfigBtn"></button>
                </form>

                <!-- È´òÁ∫ßÈÖçÁΩÆ -->
                <h3 style="color: #00ff00; margin: 25px 0 15px;" id="advancedTitle"></h3>
                <form id="advancedConfigForm">
                    <div class="form-group">
                        <label class="form-label" id="scuLabel"></label>
                        <input type="text" id="scu" class="form-input" placeholder="https://url.v1.mk/sub">
                    </div>
                    <div class="checkbox-group" style="margin-bottom: 15px;">
                        <label class="checkbox-item"><input type="checkbox" id="epd"><span id="epdLabel"></span></label>
                        <label class="checkbox-item"><input type="checkbox" id="epi" checked><span
                                id="epiLabel"></span></label>
                        <label class="checkbox-item"><input type="checkbox" id="egi" checked><span
                                id="egiLabel"></span></label>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="aeLabel"></label>
                        <select id="apiEnabled" class="form-select"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="rmLabel"></label>
                        <select id="regionMatching" class="form-select"></select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" id="dkbyLabel"></label>
                        <select id="portControl" class="form-select"></select>
                    </div>
                    <button type="submit" class="btn" id="saveAdvancedBtn"></button>
                </form>

                <!-- ÂΩìÂâçÈÖçÁΩÆÊòæÁ§∫ -->
                <div id="currentConfig" class="status-box" style="margin-top: 20px;"></div>
                <div style="margin-top: 15px;">
                    <button class="btn" onclick="loadCurrentConfig()" id="refreshBtn"></button>
                    <button class="btn btn-danger" onclick="resetAllConfig()" id="resetBtn"></button>
                </div>
            </div>
            <div id="statusMessage" class="status-msg"></div>
        </div>

        <!-- Áõ∏ÂÖ≥ÈìæÊé• -->
        <div class="card">
            <h2 class="card-title" id="linksTitle"></h2>
            <div class="links-section">
                <a href="https://github.com/byJoey/cfnew" target="_blank" id="githubLink"></a>
                <a href="https://www.youtube.com/@joeyblog" target="_blank">YouTube @joeyblog</a>
            </div>
        </div>
    </div>

    <script>
        // Â§öËØ≠Ë®ÄÁøªËØëÈÖçÁΩÆ
        const i18n = {
            zh: {
                title: 'ËÆ¢ÈòÖ‰∏≠ÂøÉ', subtitle: 'Â§öÂÆ¢Êà∑Á´ØÊîØÊåÅ ‚Ä¢ Êô∫ËÉΩ‰ºòÈÄâ ‚Ä¢ ‰∏ÄÈîÆÁîüÊàê',
                clientTitle: '[ ÈÄâÊã©ÂÆ¢Êà∑Á´Ø ]', statusTitle: '[ Á≥ªÁªüÁä∂ÊÄÅ ]',
                configTitle: '[ ÈÖçÁΩÆÁÆ°ÁêÜ ]', linksTitle: '[ Áõ∏ÂÖ≥ÈìæÊé• ]',
                version: 'ÁªàÁ´Ø v2.9.2', githubLink: 'GitHub È°πÁõÆ',
                regionLabel: 'ÊåáÂÆöÂú∞Âå∫ (wk):', autoDetect: 'Ëá™Âä®Ê£ÄÊµã',
                saveRegion: '‰øùÂ≠òÂú∞Âå∫', protocolLabel: 'ÂçèËÆÆÈÄâÊã©:',
                trojanPwdLabel: 'Trojan ÂØÜÁ†Å (ÂèØÈÄâ):', saveProtocol: '‰øùÂ≠òÂçèËÆÆ',
                customPathLabel: 'Ëá™ÂÆö‰πâË∑ØÂæÑ (d):', customIPLabel: 'Ëá™ÂÆö‰πâProxyIP (p):',
                yxLabel: '‰ºòÈÄâIPÂàóË°® (yx):', yxURLLabel: '‰ºòÈÄâIPÊù•Ê∫êURL:',
                socksLabel: 'SOCKS5ÈÖçÁΩÆ:', homepageLabel: 'Ëá™ÂÆö‰πâÈ¶ñÈ°µURL:',
                homepageHint: 'ËÆæÁΩÆËá™ÂÆö‰πâURL‰Ωú‰∏∫È¶ñÈ°µ‰º™Ë£Ö',
                saveConfig: '‰øùÂ≠òÈÖçÁΩÆ', advancedTitle: 'È´òÁ∫ßÊéßÂà∂',
                scuLabel: 'ËÆ¢ÈòÖËΩ¨Êç¢Âú∞ÂùÄ:', epdLabel: 'ÂêØÁî®‰ºòÈÄâÂüüÂêç',
                epiLabel: 'ÂêØÁî®‰ºòÈÄâIP', egiLabel: 'ÂêØÁî®GitHub‰ºòÈÄâ',
                aeLabel: 'APIÁÆ°ÁêÜ:', aeDefault: 'ÈªòËÆ§ÔºàÂÖ≥Èó≠Ôºâ', aeYes: 'ÂºÄÂêØ',
                rmLabel: 'Âú∞Âå∫ÂåπÈÖç:', rmDefault: 'ÈªòËÆ§ÔºàÂêØÁî®Ôºâ', rmNo: 'ÂÖ≥Èó≠',
                dkbyLabel: 'TLSÊéßÂà∂:', dkbyDefault: 'ÈªòËÆ§ÔºàÂÖ®ÈÉ®Ôºâ', dkbyYes: '‰ªÖTLS',
                saveAdvanced: '‰øùÂ≠òÈ´òÁ∫ßÈÖçÁΩÆ', refresh: 'Âà∑Êñ∞', reset: 'ÈáçÁΩÆ',
                checking: 'Ê£ÄÊµã‰∏≠...', workerRegion: 'WorkerÂú∞Âå∫: ',
                detectionMethod: 'Ê£ÄÊµãÊñπÂºè: ', proxyIPStatus: 'ProxyIPÁä∂ÊÄÅ: ',
                currentIP: 'ÂΩìÂâç‰ΩøÁî®IP: ', regionMatch: 'Âú∞Âå∫ÂåπÈÖç: ',
                kvEnabled: '‚úÖ KVÂ≠òÂÇ®Â∑≤ÂêØÁî®', kvDisabled: '‚ö†Ô∏è KVÂ≠òÂÇ®Êú™ÈÖçÁΩÆ',
                subCopied: 'ËÆ¢ÈòÖÈìæÊé•Â∑≤Â§çÂà∂', loading: 'Âä†ËΩΩ‰∏≠...',
                regions: { US: 'üá∫üá∏ ÁæéÂõΩ', SG: 'üá∏üá¨ Êñ∞Âä†Âù°', JP: 'üáØüáµ Êó•Êú¨', KR: 'üá∞üá∑ Èü©ÂõΩ', DE: 'üá©üá™ Âæ∑ÂõΩ', SE: 'üá∏üá™ ÁëûÂÖ∏', NL: 'üá≥üá± Ëç∑ÂÖ∞', FI: 'üá´üáÆ Ëä¨ÂÖ∞', GB: 'üá¨üáß Ëã±ÂõΩ' },
                cloudflareDetection: 'CloudflareÊ£ÄÊµã', available: 'ÂèØÁî®', smartSelection: 'Êô∫ËÉΩÈÄâÊã©‰∏≠'
            },
            fa: {
                title: 'ŸÖÿ±⁄©ÿ≤ ÿßÿ¥ÿ™ÿ±ÿß⁄©', subtitle: 'Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ⁄ÜŸÜÿØ ⁄©ŸÑÿß€åŸÜÿ™ ‚Ä¢ ÿßŸÜÿ™ÿÆÿßÿ® ŸáŸàÿ¥ŸÖŸÜÿØ',
                clientTitle: '[ ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÑÿß€åŸÜÿ™ ]', statusTitle: '[ Ÿàÿ∂ÿπ€åÿ™ ÿ≥€åÿ≥ÿ™ŸÖ ]',
                configTitle: '[ ŸÖÿØ€åÿ±€åÿ™ ÿ™ŸÜÿ∏€åŸÖÿßÿ™ ]', linksTitle: '[ ŸÑ€åŸÜ⁄©‚ÄåŸáÿß ]',
                version: 'ÿ™ÿ±ŸÖ€åŸÜÿßŸÑ v2.9.2', githubLink: 'Ÿæÿ±Ÿà⁄òŸá GitHub',
                regionLabel: 'ÿ™ÿπ€å€åŸÜ ŸÖŸÜÿ∑ŸÇŸá:', autoDetect: 'ÿ™ÿ¥ÿÆ€åÿµ ÿÆŸàÿØ⁄©ÿßÿ±',
                saveRegion: 'ÿ∞ÿÆ€åÿ±Ÿá', protocolLabel: 'ÿßŸÜÿ™ÿÆÿßÿ® Ÿæÿ±Ÿàÿ™⁄©ŸÑ:',
                trojanPwdLabel: 'ÿ±ŸÖÿ≤ Trojan:', saveProtocol: 'ÿ∞ÿÆ€åÿ±Ÿá Ÿæÿ±Ÿàÿ™⁄©ŸÑ',
                customPathLabel: 'ŸÖÿ≥€åÿ± ÿ≥ŸÅÿßÿ±ÿ¥€å:', customIPLabel: 'ProxyIP ÿ≥ŸÅÿßÿ±ÿ¥€å:',
                yxLabel: 'ŸÑ€åÿ≥ÿ™ IP ÿ™ÿ±ÿ¨€åÿ≠€å:', yxURLLabel: 'URL ŸÖŸÜÿ®ÿπ IP:',
                socksLabel: 'ÿ™ŸÜÿ∏€åŸÖÿßÿ™ SOCKS5:', homepageLabel: 'URL ÿµŸÅÿ≠Ÿá ÿßÿµŸÑ€å:',
                homepageHint: 'ÿ™ŸÜÿ∏€åŸÖ URL ÿ≥ŸÅÿßÿ±ÿ¥€å ÿ®ÿ±ÿß€å ÿßÿ≥ÿ™ÿ™ÿßÿ±',
                saveConfig: 'ÿ∞ÿÆ€åÿ±Ÿá', advancedTitle: '⁄©ŸÜÿ™ÿ±ŸÑ Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá',
                scuLabel: 'ÿ¢ÿØÿ±ÿ≥ ÿ™ÿ®ÿØ€åŸÑ:', epdLabel: 'ÿØÿßŸÖŸÜŸá ÿ™ÿ±ÿ¨€åÿ≠€å',
                epiLabel: 'IP ÿ™ÿ±ÿ¨€åÿ≠€å', egiLabel: 'GitHub ÿ™ÿ±ÿ¨€åÿ≠€å',
                aeLabel: 'ŸÖÿØ€åÿ±€åÿ™ API:', aeDefault: 'Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂', aeYes: 'ŸÅÿπÿßŸÑ',
                rmLabel: 'ÿ™ÿ∑ÿ®€åŸÇ ŸÖŸÜÿ∑ŸÇŸá:', rmDefault: 'Ÿæ€åÿ¥‚ÄåŸÅÿ±ÿ∂', rmNo: 'ÿ∫€åÿ±ŸÅÿπÿßŸÑ',
                dkbyLabel: '⁄©ŸÜÿ™ÿ±ŸÑ TLS:', dkbyDefault: 'ŸáŸÖŸá', dkbyYes: 'ŸÅŸÇÿ∑ TLS',
                saveAdvanced: 'ÿ∞ÿÆ€åÿ±Ÿá', refresh: 'ÿ™ÿßÿ≤Ÿá‚Äåÿ≥ÿßÿ≤€å', reset: 'ÿ®ÿßÿ≤ŸÜÿ¥ÿßŸÜ€å',
                checking: 'ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿ±ÿ±ÿ≥€å...', workerRegion: 'ŸÖŸÜÿ∑ŸÇŸá: ',
                detectionMethod: 'ÿ±Ÿàÿ¥: ', proxyIPStatus: 'Ÿàÿ∂ÿπ€åÿ™ ProxyIP: ',
                currentIP: 'IP ŸÅÿπŸÑ€å: ', regionMatch: 'ÿ™ÿ∑ÿ®€åŸÇ: ',
                kvEnabled: '‚úÖ KV ŸÅÿπÿßŸÑ', kvDisabled: '‚ö†Ô∏è KV ÿ∫€åÿ±ŸÅÿπÿßŸÑ',
                subCopied: '⁄©Ÿæ€å ÿ¥ÿØ', loading: 'ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å...',
                regions: { US: 'üá∫üá∏ ÿ¢ŸÖÿ±€å⁄©ÿß', SG: 'üá∏üá¨ ÿ≥ŸÜ⁄ØÿßŸæŸàÿ±', JP: 'üáØüáµ ⁄òÿßŸæŸÜ', KR: 'üá∞üá∑ ⁄©ÿ±Ÿá', DE: 'üá©üá™ ÿ¢ŸÑŸÖÿßŸÜ', SE: 'üá∏üá™ ÿ≥Ÿàÿ¶ÿØ', NL: 'üá≥üá± ŸáŸÑŸÜÿØ', FI: 'üá´üáÆ ŸÅŸÜŸÑÿßŸÜÿØ', GB: 'üá¨üáß ÿ®ÿ±€åÿ™ÿßŸÜ€åÿß' },
                cloudflareDetection: 'ÿ™ÿ¥ÿÆ€åÿµ Cloudflare', available: 'ÿØÿ± ÿØÿ≥ÿ™ÿ±ÿ≥', smartSelection: 'ÿßŸÜÿ™ÿÆÿßÿ® ŸáŸàÿ¥ŸÖŸÜÿØ'
            }
        };

        const clients = [
            { type: 'clash', name: 'CLASH', scheme: 'clash://install-config?url=' },
            { type: 'clash', name: 'STASH', scheme: 'stash://install?url=' },
            { type: 'surge', name: 'SURGE', scheme: 'surge:///install-config?url=' },
            { type: 'singbox', name: 'SING-BOX', scheme: 'sing-box://install-config?url=' },
            { type: 'loon', name: 'LOON', scheme: 'loon://install?url=' },
            { type: 'quanx', name: 'QUANTUMULT X', scheme: 'quantumult-x://install-config?url=' },
            { type: 'v2ray', name: 'V2RAY', scheme: '' },
            { type: 'v2ray', name: 'Shadowrocket', scheme: 'shadowrocket://add/' }
        ];

        let currentLang = 'zh';
        let t = i18n.zh;
        const API_BASE = window.location.pathname;
        const SUB_CONVERTER = 'https://url.v1.mk/sub';

        // Â∑•ÂÖ∑ÂáΩÊï∞
        function getCookie(name) {
            const v = '; ' + document.cookie;
            const p = v.split('; ' + name + '=');
            return p.length === 2 ? p.pop().split(';').shift() : null;
        }
        function setCookie(name, value) {
            const d = new Date(); d.setFullYear(d.getFullYear() + 1);
            document.cookie = `${name}=${value}; path=/; expires=${d.toUTCString()}; SameSite=Lax`;
        }
        function detectLanguage() {
            const saved = localStorage.getItem('preferredLanguage') || getCookie('preferredLanguage');
            if (saved === 'fa' || saved === 'fa-IR') return 'fa';
            if (saved === 'zh' || saved === 'zh-CN') return 'zh';
            return navigator.language?.includes('fa') ? 'fa' : 'zh';
        }
        function changeLanguage(lang) {
            localStorage.setItem('preferredLanguage', lang);
            setCookie('preferredLanguage', lang);
            location.reload();
        }

        // Â∫îÁî®ËØ≠Ë®Ä
        function applyLanguage(lang) {
            currentLang = lang;
            t = i18n[lang];
            document.documentElement.lang = lang === 'fa' ? 'fa-IR' : 'zh-CN';
            document.documentElement.dir = lang === 'fa' ? 'rtl' : 'ltr';
            document.title = t.title;

            // Êõ¥Êñ∞UIÊñáÊú¨
            document.getElementById('versionText').textContent = t.version;
            document.getElementById('pageTitle').textContent = t.title;
            document.getElementById('pageSubtitle').textContent = t.subtitle;
            document.getElementById('clientTitle').textContent = t.clientTitle;
            document.getElementById('statusTitle').textContent = t.statusTitle;
            document.getElementById('configTitle').textContent = t.configTitle;
            document.getElementById('linksTitle').textContent = t.linksTitle;
            document.getElementById('githubLink').textContent = t.githubLink;
            document.getElementById('regionLabel').textContent = t.regionLabel;
            document.getElementById('saveRegionBtn').textContent = t.saveRegion;
            document.getElementById('protocolLabel').textContent = t.protocolLabel;
            document.getElementById('trojanPwdLabel').textContent = t.trojanPwdLabel;
            document.getElementById('saveProtocolBtn').textContent = t.saveProtocol;
            document.getElementById('customPathLabel').textContent = t.customPathLabel;
            document.getElementById('customIPLabel').textContent = t.customIPLabel;
            document.getElementById('yxLabel').textContent = t.yxLabel;
            document.getElementById('yxURLLabel').textContent = t.yxURLLabel;
            document.getElementById('socksLabel').textContent = t.socksLabel;
            document.getElementById('homepageLabel').textContent = t.homepageLabel;
            document.getElementById('homepageHint').textContent = t.homepageHint;
            document.getElementById('saveConfigBtn').textContent = t.saveConfig;
            document.getElementById('advancedTitle').textContent = t.advancedTitle;
            document.getElementById('scuLabel').textContent = t.scuLabel;
            document.getElementById('epdLabel').textContent = t.epdLabel;
            document.getElementById('epiLabel').textContent = t.epiLabel;
            document.getElementById('egiLabel').textContent = t.egiLabel;
            document.getElementById('aeLabel').textContent = t.aeLabel;
            document.getElementById('rmLabel').textContent = t.rmLabel;
            document.getElementById('dkbyLabel').textContent = t.dkbyLabel;
            document.getElementById('saveAdvancedBtn').textContent = t.saveAdvanced;
            document.getElementById('refreshBtn').textContent = t.refresh;
            document.getElementById('resetBtn').textContent = t.reset;
            document.getElementById('languageSelector').value = lang;

            // Ê∏≤ÊüìÂÆ¢Êà∑Á´ØÊåâÈíÆ
            renderClientButtons();
            // Ê∏≤ÊüìÂú∞Âå∫ÈÄâÊã©
            renderRegionSelect();
            // Ê∏≤ÊüìÈ´òÁ∫ßÈÄâÊã©Ê°Ü
            renderAdvancedSelects();
        }

        function renderClientButtons() {
            const grid = document.getElementById('clientGrid');
            grid.innerHTML = clients.map(c =>
                `<button class="client-btn" onclick="generateLink('${c.type}','${c.name}','${c.scheme}')">${c.name}</button>`
            ).join('');
        }

        function renderRegionSelect() {
            const sel = document.getElementById('wkRegion');
            sel.innerHTML = `<option value="">${t.autoDetect}</option>` +
                Object.entries(t.regions).map(([k, v]) => `<option value="${k}">${v}</option>`).join('');
        }

        function renderAdvancedSelects() {
            document.getElementById('apiEnabled').innerHTML = `<option value="">${t.aeDefault}</option><option value="yes">${t.aeYes}</option>`;
            document.getElementById('regionMatching').innerHTML = `<option value="">${t.rmDefault}</option><option value="no">${t.rmNo}</option>`;
            document.getElementById('portControl').innerHTML = `<option value="">${t.dkbyDefault}</option><option value="yes">${t.dkbyYes}</option>`;
        }

        // ÁîüÊàêËÆ¢ÈòÖÈìæÊé•
        function generateLink(type, name, scheme) {
            const subUrl = location.href.replace(/\/$/, '') + '/sub';
            let finalUrl = subUrl;

            if (type !== 'v2ray') {
                const encoded = encodeURIComponent(subUrl);
                finalUrl = `${SUB_CONVERTER}?target=${type}&url=${encoded}&insert=false&emoji=true&list=false&expand=true&scv=false&new_name=true`;
            }

            const urlEl = document.getElementById('subUrl');
            urlEl.textContent = finalUrl;
            urlEl.style.display = 'block';

            if (scheme) {
                const schemeUrl = scheme + encodeURIComponent(finalUrl);
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = schemeUrl;
                document.body.appendChild(iframe);
                setTimeout(() => iframe.remove(), 2000);
            }

            navigator.clipboard.writeText(finalUrl).then(() => {
                showStatus(`${name} ${t.subCopied}`, 'success');
            });
        }

        // Áä∂ÊÄÅÊ£ÄÊµã
        async function checkSystemStatus() {
            try {
                const res = await fetch(`${API_BASE}/api/status`);
                const data = await res.json();

                document.getElementById('regionStatus').innerHTML = `${t.workerRegion}<span style="color:#44ff44">${t.regions[data.region] || data.region}</span>`;
                document.getElementById('geoInfo').innerHTML = `${t.detectionMethod}<span style="color:#44ff44">${t.cloudflareDetection}</span>`;
                document.getElementById('proxyIPStatus').innerHTML = `${t.proxyIPStatus}<span style="color:#44ff44">‚úÖ ${t.available}</span>`;
                document.getElementById('currentIP').innerHTML = `${t.currentIP}<span style="color:#44ff44">${t.smartSelection}</span>`;
                document.getElementById('regionMatch').innerHTML = `${t.regionMatch}<span style="color:#44ff44">‚úÖ</span>`;

                if (data.echEnabled) {
                    document.getElementById('echStatus').innerHTML = `ECH: <span style="color:#44ff44">‚úÖ ${t.available}</span>`;
                } else {
                    document.getElementById('echStatus').innerHTML = `ECH: <span style="color:#ffaa00">‚ö†Ô∏è</span>`;
                }
            } catch (e) {
                // ÂõûÈÄÄÂà∞regionÁ´ØÁÇπ
                try {
                    const res = await fetch(`${API_BASE}/region`);
                    const data = await res.json();
                    document.getElementById('regionStatus').innerHTML = `${t.workerRegion}<span style="color:#44ff44">${t.regions[data.region] || data.region}</span>`;
                    document.getElementById('geoInfo').innerHTML = `${t.detectionMethod}<span style="color:#44ff44">${data.detectionMethod || t.cloudflareDetection}</span>`;
                } catch (e2) {
                    document.getElementById('regionStatus').innerHTML = `${t.workerRegion}<span style="color:#ff4444">‚ùå</span>`;
                }
            }
        }

        // KVÈÖçÁΩÆÊ£ÄÊµã
        async function checkKVStatus() {
            try {
                const res = await fetch(`${API_BASE}/api/config`);
                if (res.status === 503) {
                    document.getElementById('kvStatus').innerHTML = `<span style="color:#ffaa00">${t.kvDisabled}</span>`;
                    document.getElementById('configCard').style.display = 'block';
                    return;
                }
                const data = await res.json();
                if (data.kvEnabled) {
                    document.getElementById('kvStatus').innerHTML = `<span style="color:#44ff44">${t.kvEnabled}</span>`;
                    document.getElementById('configContent').style.display = 'block';
                    document.getElementById('configCard').style.display = 'block';
                    loadCurrentConfig();
                } else {
                    document.getElementById('kvStatus').innerHTML = `<span style="color:#ffaa00">${t.kvDisabled}</span>`;
                    document.getElementById('configCard').style.display = 'block';
                }
            } catch (e) {
                document.getElementById('kvStatus').innerHTML = `<span style="color:#ffaa00">${t.kvDisabled}</span>`;
                document.getElementById('configCard').style.display = 'block';
            }
        }

        // Âä†ËΩΩÂΩìÂâçÈÖçÁΩÆ
        async function loadCurrentConfig() {
            try {
                const res = await fetch(`${API_BASE}/api/config`);
                if (!res.ok) return;
                const cfg = await res.json();

                // Â°´ÂÖÖË°®Âçï
                document.getElementById('wkRegion').value = cfg.wk || '';
                document.getElementById('ev').checked = cfg.ev !== 'no';
                document.getElementById('et').checked = cfg.et === 'yes';
                document.getElementById('ex').checked = cfg.ex === 'yes';
                document.getElementById('ech').checked = cfg.ech === 'yes';
                document.getElementById('tp').value = cfg.tp || '';
                document.getElementById('customPath').value = cfg.d || '';
                document.getElementById('customIP').value = cfg.p || '';
                document.getElementById('yx').value = cfg.yx || '';
                document.getElementById('yxURL').value = cfg.yxURL || '';
                document.getElementById('socksConfig').value = cfg.s || '';
                document.getElementById('customHomepage').value = cfg.homepage || '';
                document.getElementById('scu').value = cfg.scu || '';
                document.getElementById('epd').checked = cfg.epd === 'yes';
                document.getElementById('epi').checked = cfg.epi !== 'no';
                document.getElementById('egi').checked = cfg.egi !== 'no';
                document.getElementById('apiEnabled').value = cfg.ae || '';
                document.getElementById('regionMatching').value = cfg.rm || '';
                document.getElementById('portControl').value = cfg.dkby || '';

                // ÊòæÁ§∫ÂΩìÂâçÈÖçÁΩÆ
                const display = Object.entries(cfg).filter(([k]) => k !== 'kvEnabled').map(([k, v]) => `${k}: ${v || '(Á©∫)'}`).join('\n');
                document.getElementById('currentConfig').textContent = display || '(Êó†ÈÖçÁΩÆ)';
            } catch (e) {
                document.getElementById('currentConfig').textContent = 'Âä†ËΩΩÂ§±Ë¥•: ' + e.message;
            }
        }

        // ‰øùÂ≠òÈÖçÁΩÆ
        async function saveConfig(data) {
            try {
                const res = await fetch(`${API_BASE}/api/config`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();
                showStatus(result.message || '‰øùÂ≠òÊàêÂäü', result.success ? 'success' : 'error');
                if (result.success) {
                    loadCurrentConfig();
                    setTimeout(() => location.reload(), 1500);
                }
            } catch (e) {
                showStatus('‰øùÂ≠òÂ§±Ë¥•: ' + e.message, 'error');
            }
        }

        // ÈáçÁΩÆÈÖçÁΩÆ
        async function resetAllConfig() {
            if (!confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÈÖçÁΩÆÂêóÔºü')) return;
            await saveConfig({ wk: '', d: '', p: '', yx: '', yxURL: '', s: '', ae: '', rm: '', dkby: '', ev: '', et: '', ex: '', tp: '', scu: '', epd: '', epi: '', egi: '', homepage: '' });
        }

        // ÊòæÁ§∫Áä∂ÊÄÅÊ∂àÊÅØ
        function showStatus(msg, type) {
            const el = document.getElementById('statusMessage');
            el.textContent = msg;
            el.style.display = 'block';
            el.style.color = type === 'success' ? '#00ff00' : '#ff4444';
            el.style.borderColor = type === 'success' ? '#00ff00' : '#ff4444';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        // MatrixÈõ®ÊïàÊûú
        function createMatrixRain() {
            const container = document.getElementById('matrixCodeRain');
            const chars = '01ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const cols = Math.floor(window.innerWidth / 20);
            for (let i = 0; i < cols; i++) {
                const col = document.createElement('div');
                col.className = 'matrix-column';
                col.style.left = (i * 20) + 'px';
                col.style.animationDelay = (Math.random() * 15) + 's';
                col.style.animationDuration = (Math.random() * 10 + 10) + 's';
                let text = '';
                for (let j = 0; j < 30; j++) {
                    text += chars[Math.floor(Math.random() * chars.length)] + '<br>';
                }
                col.innerHTML = text;
                container.appendChild(col);
            }
        }

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            const lang = detectLanguage();
            applyLanguage(lang);
            createMatrixRain();
            checkSystemStatus();
            checkKVStatus();

            // ÁªëÂÆöË°®Âçï‰∫ã‰ª∂
            document.getElementById('regionForm').addEventListener('submit', e => {
                e.preventDefault();
                saveConfig({ wk: document.getElementById('wkRegion').value });
            });

            document.getElementById('saveProtocolBtn').addEventListener('click', () => {
                saveConfig({
                    ev: document.getElementById('ev').checked ? 'yes' : 'no',
                    et: document.getElementById('et').checked ? 'yes' : 'no',
                    ex: document.getElementById('ex').checked ? 'yes' : 'no',
                    ech: document.getElementById('ech').checked ? 'yes' : 'no',
                    tp: document.getElementById('tp').value
                });
            });

            document.getElementById('basicConfigForm').addEventListener('submit', e => {
                e.preventDefault();
                saveConfig({
                    d: document.getElementById('customPath').value,
                    p: document.getElementById('customIP').value,
                    yx: document.getElementById('yx').value,
                    yxURL: document.getElementById('yxURL').value,
                    s: document.getElementById('socksConfig').value,
                    homepage: document.getElementById('customHomepage').value
                });
            });

            document.getElementById('advancedConfigForm').addEventListener('submit', e => {
                e.preventDefault();
                saveConfig({
                    scu: document.getElementById('scu').value,
                    epd: document.getElementById('epd').checked ? 'yes' : 'no',
                    epi: document.getElementById('epi').checked ? 'yes' : 'no',
                    egi: document.getElementById('egi').checked ? 'yes' : 'no',
                    ae: document.getElementById('apiEnabled').value,
                    rm: document.getElementById('regionMatching').value,
                    dkby: document.getElementById('portControl').value
                });
            });
        });
    </script>
</body>

</html>